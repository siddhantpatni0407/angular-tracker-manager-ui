<div class="container mt-4">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <button class="btn btn-outline-primary" (click)="goBack()">
      ⬅ Back to Credential Tracker
    </button>
    <h2 class="text-primary fw-bold">
      <i class="bi bi-shield-lock"></i> Credentials
    </h2>
    <div></div>
  </div>

  <!-- Search Input -->
  <div class="row g-3 align-items-center mb-4">
    <div class="col-md-8">
      <label class="form-label fw-bold">🔍 Search Credentials</label>
      <input
        type="text"
        class="form-control shadow-sm"
        placeholder="Filter by account name, type, or username..."
        [(ngModel)]="searchText"
        (input)="filterCredentials()"
      />
    </div>

    <!-- Export Dropdown -->
    <div class="col-md-4 text-end" style="position: relative; z-index: 1050">
      <label class="form-label fw-bold d-block">📤 Export</label>
      <div class="btn-group">
        <button
          class="btn btn-primary dropdown-toggle shadow-sm"
          type="button"
          id="exportDropdown"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          Export Data
        </button>
        <ul class="dropdown-menu dropdown-menu-end" style="z-index: 1051">
          <li>
            <a class="dropdown-item" (click)="exportToExcel()">
              <i class="bi bi-file-earmark-spreadsheet"></i> Export to Excel
            </a>
          </li>
          <li>
            <a class="dropdown-item" (click)="exportToPDF()">
              <i class="bi bi-file-earmark-pdf"></i> Export to PDF
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Credentials Table with Scroll -->
  <div class="table-responsive" style="max-height: 400px; overflow-y: auto">
    <table class="table table-hover table-bordered text-center shadow-sm">
      <thead class="table-dark sticky-top">
        <tr>
          <th>#</th>
          <th (click)="sortCredentials('accountName')" class="sortable">
            🔐 Account Name ⬍
          </th>
          <th (click)="sortCredentials('accountType')" class="sortable">
            📁 Account Type ⬍
          </th>
          <th (click)="sortCredentials('website')" class="sortable">
            🌐 Website ⬍
          </th>
          <th (click)="sortCredentials('url')" class="sortable">🔗 URL ⬍</th>
          <th (click)="sortCredentials('username')" class="sortable">
            👤 Username ⬍
          </th>
          <th (click)="sortCredentials('email')" class="sortable">
            📧 Email ⬍
          </th>
          <th (click)="sortCredentials('mobileNumber')" class="sortable">
            📱 Mobile Number ⬍
          </th>
          <th (click)="sortCredentials('status')" class="sortable">
            📊 Status ⬍
          </th>
          <th (click)="sortCredentials('remarks')" class="sortable">
            📝 Remarks ⬍
          </th>
          <th>🔑 Password</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let credential of filteredCredentials; let i = index"
          (click)="openCredentialModal(credential, credentialModal)"
          style="cursor: pointer"
        >
          <td>{{ i + 1 }}</td>
          <td>{{ credential.accountName }}</td>
          <td>{{ credential.accountType }}</td>
          <td>{{ credential.website }}</td>
          <td>{{ credential.url }}</td>
          <td>{{ credential.username }}</td>
          <td>{{ credential.email }}</td>
          <td>{{ credential.mobileNumber }}</td>
          <td>{{ credential.status }}</td>
          <td>{{ credential.remarks }}</td>
          <td>
            <div class="d-flex align-items-center justify-content-center">
              <!-- Password Field -->
              <span *ngIf="!credential.showPassword">••••••••</span>
              <span *ngIf="credential.showPassword">{{
                credential.password
              }}</span>

              <!-- View Icon -->
              <button
                class="btn btn-link p-0 ms-2"
                (click)="
                  togglePasswordVisibility(credential); $event.stopPropagation()
                "
              >
                <i
                  class="bi"
                  [ngClass]="{
                    'bi-eye': !credential.showPassword,
                    'bi-eye-slash': credential.showPassword
                  }"
                ></i>
              </button>
            </div>
          </td>
        </tr>

        <!-- No Data Found Row -->
        <tr *ngIf="filteredCredentials.length === 0">
          <td colspan="11" class="text-center text-muted">
            ⚠️ No credentials found.
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Credential Details Modal -->
<ng-template #credentialModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Credential Details</h5>
    <button
      type="button"
      class="btn-close"
      (click)="modal.dismiss()"
      aria-label="Close"
    ></button>
  </div>
  <div class="modal-body">
    <div *ngIf="selectedCredential">
      <p><strong>Account Name:</strong> {{ selectedCredential.accountName }}</p>
      <p><strong>Account Type:</strong> {{ selectedCredential.accountType }}</p>
      <p><strong>Website:</strong> {{ selectedCredential.website }}</p>
      <p><strong>URL:</strong> {{ selectedCredential.url }}</p>
      <p><strong>Username:</strong> {{ selectedCredential.username }}</p>
      <p><strong>Email:</strong> {{ selectedCredential.email }}</p>
      <p>
        <strong>Mobile Number:</strong> {{ selectedCredential.mobileNumber }}
      </p>
      <p><strong>Status:</strong> {{ selectedCredential.status }}</p>
      <p><strong>Remarks:</strong> {{ selectedCredential.remarks }}</p>
      <p>
        <strong>Password:</strong>
        <span *ngIf="!selectedCredential.showPassword">••••••••</span>
        <span *ngIf="selectedCredential.showPassword">{{
          selectedCredential.password
        }}</span>
        <button
          class="btn btn-link p-0 ms-2"
          (click)="togglePasswordVisibility(selectedCredential)"
        >
          <i
            class="bi"
            [ngClass]="{
              'bi-eye': !selectedCredential.showPassword,
              'bi-eye-slash': selectedCredential.showPassword
            }"
          ></i>
        </button>
      </p>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
      Close
    </button>
  </div>
</ng-template>

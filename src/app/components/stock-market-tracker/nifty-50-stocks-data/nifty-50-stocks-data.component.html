<div class="container mt-4">

  <!-- Header & Controls -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <button class="btn btn-outline-secondary btn-lg" (click)="goToStockMarketTracker()">
      ‚¨ÖÔ∏è Back
    </button>
    <h3 class="text-primary text-center fw-bold flex-grow-1">
      <img src="https://www.nseindia.com/assets/images/NSE_Logo.svg" alt="NSE Logo" width="90" class="me-2"> üìà NIFTY 50 Stock Data
    </h3>
    <div class="d-flex gap-3">
      <!-- Refresh Button -->
      <button class="btn btn-success btn-lg d-flex align-items-center gap-2" (click)="fetchStockData()" [disabled]="isLoading">
        üîÑ Refresh
      </button>

      <!-- Export Dropdown -->
      <div class="btn-group">
        <button class="btn btn-primary dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          ‚¨áÔ∏è Export
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li>
            <a class="dropdown-item d-flex align-items-center gap-2" (click)="exportToExcel()">
              <i class="bi bi-file-earmark-spreadsheet"></i> Export to Excel
            </a>
          </li>
          <li>
            <a class="dropdown-item d-flex align-items-center gap-2" (click)="exportToPDF()">
              <i class="bi bi-file-earmark-pdf"></i> Export to PDF
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Filter Input -->
  <div class="input-group mb-3">
    <span class="input-group-text bg-primary text-white">üîç</span>
    <input type="text" class="form-control shadow-sm" placeholder="Filter by Symbol..." [(ngModel)]="filterText" (input)="applyFilter()">
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="text-center mt-4">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2 fw-semibold">Fetching latest stock data...</p>
  </div>

  <!-- Scrollable Table Container with Slider -->
  <div class="table-wrapper">
    <div class="table-scroll">
      <table class="table table-hover table-bordered text-center align-middle shadow-sm">
        <thead class="table-gradient text-white bg-dark">
          <tr>
            <th (click)="sortTable('priority')"># ‚¨ç</th>
            <th (click)="sortTable('symbol')">Symbol ‚¨ç</th>
            <th (click)="sortTable('open')">Open ‚¨ç</th>
            <th (click)="sortTable('previousClose')">Previous Close ‚¨ç</th>
            <th (click)="sortTable('yearHigh')">Year High ‚¨ç</th>
            <th (click)="sortTable('yearLow')">Year Low ‚¨ç</th>
            <th (click)="sortTable('dayHigh')">High ‚¨ç</th>
            <th (click)="sortTable('dayLow')">Low ‚¨ç</th>
            <th (click)="sortTable('lastPrice')">Last Price ‚¨ç</th>
            <th (click)="sortTable('lastUpdateTime')">Last Update ‚¨ç</th>
            <th>Chart</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let stock of filteredStocks; let i = index" class="table-row">
            <td>{{ i + 1 }}</td>
            <td class="stock-symbol">{{ stock.symbol }}</td>
            <td [ngClass]="{ 'text-success fw-bold': stock.open > stock.previousClose, 'text-danger fw-bold': stock.open < stock.previousClose }">
              {{ stock.open | number:'1.2-2' }}
            </td>
            <td>{{ stock.previousClose | number:'1.2-2' }}</td>
            <td class="text-info fw-semibold">{{ stock.yearHigh | number:'1.2-2' }}</td>
            <td class="text-warning fw-semibold">{{ stock.yearLow | number:'1.2-2' }}</td>
            <td>{{ stock.dayHigh | number:'1.2-2' }}</td>
            <td>{{ stock.dayLow | number:'1.2-2' }}</td>
            <td [ngClass]="{ 'text-success fw-bold': stock.lastPrice >= stock.previousClose, 'text-danger fw-bold': stock.lastPrice < stock.previousClose }">
              {{ stock.lastPrice | number:'1.2-2' }}
            </td>
            <td>{{ stock.lastUpdateTime }}</td>
            <td>
              <img [src]="stock.chartTodayPath" alt="Stock Chart" width="80" class="rounded shadow-sm">
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- No Data Message -->
  <p *ngIf="!filteredStocks.length && !isLoading" class="text-muted text-center mt-3">
    ‚ö†Ô∏è No data available.
  </p>

  <!-- NSE Footer Logo -->
  <div class="text-center mt-4">
    <img src="https://www.nseindia.com/assets/images/NSE_Logo.svg" alt="NSE Logo" width="120">
    <p class="text-muted mt-2">Powered by NSE India</p>
  </div>
</div>
